
## 协作与社群管理模块功能实现开发思路

**模块核心目标：** 通过线上互动、社交学习和成就激励，增强师生及学生间的交流与合作，构建积极的学习氛围。

### 一、实时线上自习室

**功能概述：** 提供一个虚拟的共同学习空间，支持静默学习和讨论交流两种模式，实时显示成员状态和专注时长。

**数据库表关联：**
*   `study_room`：存储自习室基本信息（房间ID、名称、创建者、模式、密码（如果私密）、最大人数、当前人数、创建时间、公告等）。
*   `study_room_member`：存储自习室成员信息（房间ID、用户ID、加入时间、当前状态（在线/离开）、音视频状态、累计专注时长等）。
*   `user`：关联用户信息。

**工作流程与实现思路：**

1.  **创建自习室：**
    *   用户（学生/教师）在前端选择“创建自习室”。
    *   填写自习室信息：名称、选择模式（静默/讨论）、设置是否私密（如私密则需设置密码）、可选填公告。
    *   后端接收请求，在 `study_room` 表中创建一条新记录，并将创建者信息写入 `study_room_member` 表。
    *   **教学案例启发**：可以参考“座位预约”案例中对资源（座位）的创建和管理逻辑，自习室也是一种共享资源。

2.  **加入自习室：**
    *   用户可以浏览公开自习室列表或通过房间ID/邀请链接加入。
    *   公开房间：直接加入。
    *   私密房间：输入密码验证。
    *   后端验证通过后，在 `study_room_member` 表中为该用户创建记录，并更新 `study_room` 表的当前人数。
    *   **实时同步**：通过WebSocket或MQ消息队列（如文档中提到的 `study_room_region` 和 `member_status_queue`）实时推送成员加入/退出、状态变更（如开启/关闭摄像头/麦克风）的信息给房间内所有成员。

3.  **自习室功能：**
    *   **成员列表展示**：实时显示在线成员及其状态（如是否开启摄像头）。
    *   **计时功能**：成员进入自习室后，自动开始个人专注计时（可与“智能学习计时”模块联动，数据记录到 `study_timer` 表）。
    *   **音视频互动（讨论模式）**：
        *   集成WebRTC等技术实现音视频通话。
        *   用户可以控制自己的摄像头和麦克风开关。
        *   房主/管理员可拥有禁言、移除成员等权限（需在 `study_room_member` 表中增加角色字段，或与用户模块的权限管理联动）。
    *   **专注时长排行榜**：实时展示房间内成员的专注时长排行（基于 `study_room_member` 表的累计专注时长或关联 `study_timer` 表）。
    *   **屏幕共享（可选）**：在讨论模式下，允许成员共享屏幕。
    *   **文件共享（可选）**：允许成员在自习室内共享临时文件。

4.  **退出/解散自习室：**
    *   成员主动退出：更新 `study_room_member` 表状态，更新 `study_room` 当前人数。
    *   创建者解散自习室：删除 `study_room` 记录及所有关联的 `study_room_member` 记录（或标记为已解散）。
    *   通过MQ通知所有成员房间已解散。

**数据库设计契合度：**
*   `study_room` 表建议补充字段：`name` (自习室名称), `creator_id` (外键关联 `user` 表), `max_members`, `current_members`, `announcement`, `create_time`。
*   `study_room_member` 表建议补充字段：`user_id` (外键关联 `user` 表), `join_time`, `status` (ENUM: 'online', 'away'), `audio_enabled` (BOOLEAN), `video_enabled` (BOOLEAN), `accumulated_focus_time` (INT, 秒)。

### 二、智能学习计时

**功能概述：** 提供灵活的计时工具，帮助学生规划学习时间，记录专注时长，并与成就系统联动。

**数据库表关联：**
*   `study_timer`：存储用户的每一次学习计时记录。
*   `user`：关联用户信息。

**工作流程与实现思路：**

1.  **启动计时：**
    *   用户选择计时模式：标准计时（正计时/倒计时）或番茄钟模式。
    *   标准计时：可设定目标时长。
    *   番茄钟：按预设的专注/休息周期进行。
    *   后端在 `study_timer` 表创建一条记录，包含 `user_id`, `start_time`, `mode`, `target_duration` (如果设定)。

2.  **计时过程：**
    *   前端显示计时器。
    *   可选：屏蔽系统通知（需客户端配合）。
    *   用户可暂停、继续、停止计时。
    *   **中断记录**：如果用户中途停止或番茄钟休息，可记录中断原因（如 `study_timer` 表中的 `interruption_reasons` JSON数组）。

3.  **计时结束：**
    *   记录 `end_time` 和实际 `duration` 到 `study_timer` 表。
    *   更新 `interruption_count`。
    *   数据同步至“学习成就系统”，用于计算总专注时长、触发相关成就。

4.  **数据统计与展示：**
    *   用户可查看自己的专注时长统计（日/周/月），如专注曲线图。
    *   分析中断原因，提供改进建议（如“您本周80%中断源于手机通知”）。

**数据库设计契合度：**
*   `study_timer` 表设计基本符合需求，`interruption_reasons` 使用JSON数组存储是合理的。

### 三、交流社区

**功能概述：** 提供一个师生交流、问题讨论、资源分享的平台，支持发帖、评论、点赞、打卡等互动功能。

**数据库表关联：**
*   `post`：存储帖子信息。
*   `comment`：存储评论信息。
*   `like_record`：存储点赞记录。
*   `tag`：存储标签信息。
*   `post_tag`：帖子与标签的关联表。
*   `user`：关联用户信息。
*   `user_daily_check_in`：用户每日打卡记录。

**工作流程与实现思路：**

1.  **帖子发布与浏览：**
    *   用户创建帖子：输入标题、内容（富文本编辑器，支持图片、附件上传），选择或创建标签。
    *   后端保存帖子信息到 `post` 表，附件信息可存为JSON或关联到专门的附件表。标签关联写入 `post_tag`。
    *   **敏感词过滤**：后端对帖子内容进行实时敏感词过滤。
    *   用户浏览帖子列表（支持按时间、热度、标签筛选和搜索）。

2.  **互动功能：**
    *   **评论**：用户对帖子进行评论，支持层级评论。评论信息存入 `comment` 表，关联 `post_id` 和 `user_id`，以及 `parent_comment_id`（用于层级）。
    *   **点赞**：用户对帖子或评论点赞。记录存入 `like_record` 表（包含 `user_id`, `target_id` (帖子或评论ID), `target_type` (ENUM: 'post', 'comment')）。
    *   **通知**：当帖子被评论、点赞，或评论被回复时，通过系统通知（站内信/APP推送，可利用MQ）通知相关用户。
        *   **教学案例启发**：“借书助手”中GPT生成链接后整合到任务中，这里的通知也可以是系统自动生成并推送给用户。

3.  **标签管理：**
    *   系统可预设一些通用标签（如学科、课程名）。
    *   用户发帖时可选择已有标签或创建新标签（新标签可能需要审核机制）。
    *   标签信息存储在 `tag` 表。

4.  **打卡机制：**
    *   用户每日可以进行学习打卡。
    *   打卡记录存入 `user_daily_check_in` 表（`user_id`, `check_in_date`, `mood_emoji`, `short_summary`）。
    *   连续打卡可获得成就系统中的奖励。
    *   用户可查看个人打卡日历。

**数据库设计契合度：**
*   `post` 表的 `attachments` 字段若使用JSON存储加密URL是可行的。考虑是否需要独立的 `attachment` 表来管理附件元数据。
*   需要 `tag` 和 `post_tag` 表来实现多对多标签功能。
*   需要 `user_daily_check_in` 表。
*   `like_record` 表建议增加 `target_type` 字段来区分是对帖子还是评论的点赞。

### 四、学习成就系统

**功能概述：** 通过徽章、排行榜等形式激励用户积极参与学习和社区互动，记录和展示用户的学习成果。

**数据库表关联：**
*   `achievement`：定义各种成就及其达成条件。
*   `user_achievement`：记录用户已解锁的成就及进度。
*   `user`：关联用户信息。
*   `study_timer`, `post`, `comment`, `like_record`, `user_daily_check_in` 等表作为成就数据来源。

**工作流程与实现思路：**

1.  **成就定义：**
    *   管理员在后台定义成就：名称、描述、图标、触发条件（如累计专注时长达到X小时、连续打卡X天、发布X篇优质帖子、获得X个赞等）。
    *   `achievement` 表的 `condition` 字段使用JSON格式描述复杂的触发逻辑。

2.  **数据收集与成就判断：**
    *   系统定期或实时收集用户在各模块的行为数据（如通过MQ消费相关事件，或定时任务扫描相关数据表）。
    *   根据 `achievement` 表中定义的条件，判断用户是否达成成就。
    *   达成成就后，在 `user_achievement` 表中创建或更新记录，标记解锁时间和进度。

3.  **成就展示：**
    *   **徽章墙**：用户个人主页展示已获得的徽章。
    *   **排行榜**：例如专注时长总榜、本周活跃榜等（需要额外的数据聚合逻辑）。
    *   **统计图表**：如专注时长多维度统计图（日/周/月/年）、打卡日历。

4.  **权限：**
    *   学生端：查看个人成就数据、排行榜。
    *   教师端：可查看所教课程/班级学生的总体成就情况、专注时长统计等（需注意数据隐私和权限控制，与用户模块权限联动）。

**数据库设计契合度：**
*   `achievement` 表的 `condition` 字段用JSON存储条件是灵活的做法。
*   `user_achievement` 表记录用户成就和进度，设计合理。

## 模块联动

*   **用户模块**：获取用户基本信息、身份、权限。
*   **学情模块**：成就系统可以从学情模块获取作业/测验分数等作为成就判断依据。
*   **资源管理与推荐模块**：社区中分享的优质资源可以被推荐，热门资源数据可反馈给推荐系统。
*   **教师智能教学模块**：教师可以在社区发布通知、答疑。

## 教学案例结合

*   **借书助手/图书馆咨询助手**：社区可以集成一个轻量级的问答机器人，或者用户可以在社区提问，由AI助手或教师/其他同学回答。帖子的标签功能有助于对问题进行分类。
*   **作业布置/座位预约**：这些案例体现了对资源的管理和状态的追踪。自习室的创建和管理、学习计时器的状态变更，都可以借鉴这些案例中的设计思想，例如使用清晰的状态字段、记录操作日志等。
*   **插件编写**：如果社区需要更复杂的互动功能，例如投票、小调研等，可以考虑通过插件化的方式进行扩展，这与项目中提到的插件编写教学案例相契合。

## 待进一步明确的设计点

1.  **消息推送的具体实现**：MQ的Topic和Queue设计，消息格式，以及客户端如何接收和展示通知。
2.  **排行榜的计算和更新策略**：实时计算还是定时更新，数据如何高效聚合。
3.  **内容审核机制**：社区帖子的审核流程（人工/自动），敏感词库的维护。
4.  **教师在社群中的具体角色和权限**：除了查看学生数据，是否可以创建官方话题、管理社区版块等。

希望这份详细的规划能帮助您更好地实现协作与社群模块！如果您有其他问题或需要调整的地方，请随时告诉我。
        当前模型请求量过大，请求排队约 1 位，请稍候或切换至其他模型问答体验更流畅。